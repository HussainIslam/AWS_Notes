# Identify and Access Management (IAM)

## Intro
* IAM includes:
	* Users (physical person)
	* Groups (functions and teams; contains users)
	* Roles (internal usage within resources; for machines)
* 'Root' account should never be used
* Users must be created with proper permissions
* IAM is at the center of AWS
* Policies are written in JSON
* Policies interact with Users, Groups, and Roles
* IAM has global view (common for all regions)
* Permissions are governed by Policies
* MFA can be setup
* IAM has predefined policies
* Apply **Least Privilege Priciples**
* Policies will **union** for IAM and S3

## IAM Federation
* For large corporations
* can integrate company's own repository of users with IAM
* This uses SAML(example: Microsoft Active Directory)

## Tasks
* Add MFA
* Create User
* Create Group
* Additing user to group
* Remove user from group
* Setting IAM Password policy

## Manage MFA
In IAM console:
1. Click "Users" from left side menu
2. Select a user
3. Select "Security Credentials"
4. Click "Manage" beside "Assigned MFA device"
5. Select "Virtual MFA device" and "Continue"
6. Under #2, Click "Show QR Code" (Install Google Authenticator on phone first)
	* Google Authenticator: https://support.google.com/accounts/answer/1066447?co=GENIE.Platform%3DAndroid&hl=en
	* Authy: https://authy.com/
	* LastPass Authenticator: https://lastpass.com/auth/
7. Under #3, enter two consecutive code shown in the Google Authenticator app
8. Click "Assign MFA"
9. Observer confirmation and click "Close"

## Creating Users
1. Click Users
2. Add User
3. Give it a name
4. Select access type: Programmatic and Console
5. Enable "Autogenerated password" 
6. select "User must create a new password at next sign-in"
7. Next:Permission
8. Permissions can be applied based on three types:
	* Add to a group
	* Copy from existing user
	* Attach existing policies to the user
9. Next:Tags
10. Can add "Tag" and a value for the tag
11. Next:Review
12. If everything looks good, click "Create User"
13. **Important** Download the csv file or Click show in the table to see the password

## Creating Groups
1. click Groups from left
2. Set a group name and click next
3. Attach a policy (for example: AdministratorAccess) and click next
4. Click create group

## Adding Users to Group
1. click Group
2. On "Users" tab, click "Add Users to Group"
3. Select users to add to the group
4. Click "Add Users"

## IAM Password Policy
1. Click "Account Settings"
2. Change password policy
3. Select the password policies
4. Click Save

## Authorization Model
1. if there's explicit DENY, then deny
2. if there's an ALLOW, then allow
3. Deny everything else

## Dynamic Policies
* use case: allow each user a /home/<user> directory in S3: `${aws:username}`
* rather than having policies for each user, have a dynamic policy

## Types Policies
* AWS Managed Policies
	* maintained by AWS
	* good for power users and admins
	* updated by AWS in case of new services/APIs
* Customer Managed Policy
	* granular control
	* best practice
	* version controlled
	* re-usable
* Inline Policy
	* Strict one-to-one relation between policy and principal
	* policy is deleted with Principal

## AWS Directory Services
* Help manage Microsoft Active Directory
* Flavours:
	1. AWS managed MS AD
		* create AD in AWS, manage users locally
		* Supports MFA
		* can establish 'trust' connection with on-premise AD
	2. AD Connector
		* Directory Gateway (proxy) to redirect to on-premise AD
		* users are managed on-premise AD
	3. Simple AD
		* stand alone
		* AD-compatible managed directory on AWS
		* can't be joined with on-premise AD
## Notes
* It is better to assign user to groups and attach policies to groups rather than attaching policies to individual users
* Customize the account alias from IAM Dashboard